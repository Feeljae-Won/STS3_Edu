<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.air.mapper.AirMapper">

	<!-- id 는 메소드 이름과 같아야 한다. -->
	<select id="list" resultType="org.zerock.air.vo.AirVO">
		select no, title, writer, writeDate, hit, replyCnt
			from (
				select rownum rnum, no, title, writer, writeDate, hit, replyCnt
				from ( select no, title, content, writer, writeDate, hit,
						(select count(*) from reply r where r.no = b.no) replyCnt
					from board b
					<!-- 검색을 달아야 한다. -->
					<include refid="search"></include>
					order by no desc
			)
		) where rnum between #{startRow} and #{endRow}
	</select>
	
	<!-- 일반 게시판 리스트의 검색 처리 -->
	<sql id="search">
		<!-- word가 있을 때만 검색한다. myBatis 형식 -->
		<if test="word != null and word != ''.toString()">
			where
			<!-- 앞에 있는 or 는 지우자 -->
			<trim prefixOverrides="or">
				<!-- t를 포함하고 있으면 -->
				<!-- 'test' : 문자열(String), 't' : 문자(char) -> 문자열 - toString() 사용 -->
				<if test="key.indexOf('t') >= 0 ">
					or title like '%' || #{word} || '%'
				</if>
				<if test="key.indexOf('c') >= 0 ">
					or content like '%' || #{word} || '%'
				</if>
				<if test="key.indexOf('w') >= 0 ">
					or writer like '%' || #{word} || '%'
				</if>
				
			</trim>
		</if>
	</sql>

</mapper>